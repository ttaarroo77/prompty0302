<div class="row">
  <div class="col-md-8">
    <div class="card mb-4">
      <div class="card-header d-flex justify-content-between">
        <h5 class="mb-0">プロンプト詳細</h5>
      </div>
      
      <div class="card-body">
        <%= form_with model: @prompt, local: true, method: :patch, id: "prompt-form", html: { data: { turbo: false } } do |f| %>
          <div class="mb-3">
            <%= f.label :title, "タイトル", class: "form-label" %>
            <%= f.text_field :title, class: "form-control" %>
          </div>
          
          <div class="mb-3">
            <%= f.label :url, "URL", class: "form-label" %>
            <%= f.text_field :url, class: "form-control" %>
          </div>
          
          <div class="mb-3">
            <%= f.label :description, "説明", class: "form-label" %>
            <%= f.text_area :description, class: "form-control", rows: 3 %>
          </div>
          
          <div class="mb-3">
            <label class="form-label">タグ</label>
            <div class="d-flex flex-wrap gap-2">
              <% @prompt.tags.each do |tag| %>
                <div class="d-flex align-items-center">
                  <span class="badge bg-info text-white"><%= tag.name %></span>
                  <%= button_to prompt_tag_path(@prompt, tag), 
                      method: :delete, 
                      class: "btn btn-sm btn-link text-dark p-0 ms-1", 
                      title: "削除",
                      form: { 
                        style: "display: inline;", 
                        data: { turbo: false },
                        id: "delete-tag-#{tag.id}"
                      } do %>
                    <i class="bi bi-x-circle-fill"></i>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <div class="mt-2 d-flex">
              <%= form_with url: prompt_tags_path(@prompt), method: :post, class: "d-flex", data: { turbo: false } do |f| %>
                <div class="input-group" style="max-width: 300px;">
                  <%= f.text_field :tag, name: "tag[name]", class: "form-control form-control-sm", placeholder: "新しいタグ" %>
                  <button type="submit" class="btn btn-sm btn-outline-secondary">追加</button>
                </div>
              <% end %>
              
              <%= button_to generate_tags_prompt_path(@prompt), method: :post, class: "btn btn-sm btn-outline-primary ms-2", data: { turbo: false } do %>
                <i class="bi bi-tag"></i> タグを生成
              <% end %>
            </div>
          </div>
          
          <div class="d-flex justify-content-between">
            <%= f.submit "保存", class: "btn btn-primary", data: { method: "patch" } %>
            <%# プロンプト削除ボタン - 一時的にコメントアウト %>
            <% 
            # button_to prompt_path(@prompt), method: :delete, class: "btn btn-danger", form: { data: { turbo: false } }, data: { confirm: "本当に削除しますか？" } do 
            #   削除
            # end 
            %>
          </div>
        <% end %>
      </div>
    </div>
    
    <%# チャットインターフェース - 一時的にコメントアウト %>
    <%
    # <div class="card">
    #   <div class="card-header">
    #     <h5 class="mb-0">チャット</h5>
    #   </div>
    #   
    #   <div class="card-body">
    #     <!-- 過去の会話表示 -->
    #     <div class="chat-history mb-3" style="max-height: 400px; overflow-y: auto;">
    #       @conversations.each do |conversation|
    #         <div id="conversation-#{conversation.id}" class="mb-3">
    #           conversation.content.to_s.split(/\n\n+/).each do |paragraph|
    #             if paragraph.start_with?("ユーザー:")
    #               <div class="d-flex mb-2">
    #                 <div class="bg-light p-2 rounded" style="max-width: 80%;">
    #                   simple_format(paragraph)
    #                 </div>
    #               </div>
    #             elsif paragraph.start_with?("AIアシスタント:")
    #               <div class="d-flex mb-2 justify-content-end">
    #                 <div class="bg-primary text-white p-2 rounded" style="max-width: 80%;">
    #                   simple_format(paragraph)
    #                 </div>
    #               </div>
    #             end
    #           end
    #         </div>
    #       end
    #     </div>
    #     
    #     <!-- 新規メッセージ入力 -->
    #     form_with url: prompt_conversations_path(@prompt), method: :post, local: true, class: "chat-form" do |f|
    #       <div class="input-group">
    #         f.text_area :message, class: "form-control", placeholder: "メッセージを入力...", rows: 2
    #         <button type="submit" class="btn btn-success">送信</button>
    #       </div>
    #     end
    #   </div>
    # </div>
    %>
  </div>
</div>
